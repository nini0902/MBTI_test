<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>沒必要但挺搞的測驗</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-bg: #1e1e2d;
            --secondary-bg: #2b2b3d;
            --accent-color: #7c3aed;
            --text-color: #ffffff;
            --text-secondary: #ffffff;
            --card-bg: #252636;
            --highlight: #9f7aea;
            --border-color: #374151;
        }

        body {
            background-color: var(--primary-bg);
            color: var(--text-color);
        }

        .navbar-brand, 
        .nav-link,
        .nav-tabs .nav-link,
        .card,
        .btn-primary,
        .option-btn,
        .testimonial-text,
        .testimonial-author,
        .footer-link,
        .compatibility-item,
        .personality-item,
        p, h1, h2, h3, h4, h5, h6,
        .text-secondary,
        .description,
        .mbti-code,
        .mbti-name,
        .feature-list li,
        .personality-stats,
        .footer-heading,
        .footer-link {
            color: var(--text-color) !important;
        }

        .nav-tabs .nav-link:hover {
            color: var(--highlight) !important;
        }

        .footer-link:hover {
            color: var(--highlight) !important;
        }

        .navbar {
            background: var(--secondary-bg);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 0;
        }

        .nav-tabs {
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 2rem;
        }

        .nav-tabs .nav-link {
            color: var(--text-secondary);
            border: none;
            padding: 1rem 2rem;
            margin-right: 0.5rem;
            border-radius: 0.5rem 0.5rem 0 0;
            transition: all 0.3s ease;
        }

        .nav-tabs .nav-link.active {
            color: var(--highlight);
            background: var(--card-bg);
            border-bottom: 3px solid var(--highlight);
        }

        .nav-tabs .nav-link:hover {
            color: var(--text-color);
            background: var(--secondary-bg);
        }

        .container {
            max-width: 900px;
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .btn-primary {
            background: var(--accent-color);
            border: none;
            padding: 0.8rem 2rem;
            border-radius: 30px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: #5652c7;
            transform: translateY(-2px);
        }

        .progress-bar {
            height: 8px;
            background: #444;
            border-radius: 4px;
            margin: 1rem 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent-color);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .question-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        #question-text {
            color: var(--text-color);
            font-size: 1.2em;
            margin-bottom: 1.5rem;
        }

        .option-btn {
            width: 100%;
            padding: 1rem;
            margin: 0.5rem 0;
            background: var(--secondary-bg);
            border: 2px solid var(--accent-color);
            color: var(--text-color);
            font-size: 1.1em;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .option-btn:hover {
            background: var(--accent-color);
            color: var(--text-color);
            transform: translateY(-2px);
        }

        .result-card {
            text-align: center;
        }

        .personality-chart {
            max-width: 600px;
            margin: 2rem auto;
        }

        .mbti-emoji {
            font-size: 4em;
            margin: 1rem 0;
        }

        .mbti-code {
            font-size: 2.5em;
            color: var(--accent-color);
            margin: 1rem 0;
        }

        .description {
            color: var(--text-color);
            font-size: 1.1em;
            line-height: 1.8;
            margin: 1.5rem 0;
        }

        .personality-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            padding: 1rem;
        }

        .personality-item {
            background: var(--secondary-bg);
            padding: 1.5rem;
            border-radius: 12px;
            transition: transform 0.3s ease;
        }

        .personality-item:hover {
            transform: translateY(-5px);
        }

        .personality-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            padding: 0.5rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .tab-content {
            min-height: 400px;
        }

        #all-personalities {
            display: none;
        }

        #all-personalities.active {
            display: block;
        }

        .share-button {
            background: var(--accent-color);
            color: var(--text-color);
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 30px;
            margin: 1rem;
            transition: all 0.3s ease;
        }

        .share-button:hover {
            background: #5652c7;
            transform: translateY(-2px);
        }

        .testimonial-card {
            background: var(--secondary-bg);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            border-left: 4px solid var(--highlight);
        }

        .testimonial-text {
            color: var(--text-color);
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .testimonial-author {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 1rem;
        }

        .compatibility-chart {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .compatibility-item {
            background: var(--secondary-bg);
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid;
            color: var(--text-color);
        }

        .compatibility-good {
            border-color: #10b981;
        }

        .compatibility-bad {
            border-color: #ef4444;
        }

        footer {
            background: var(--secondary-bg);
            padding: 3rem 0;
            margin-top: 4rem;
            border-top: 1px solid var(--border-color);
        }

        .footer-heading {
            color: var(--text-color);
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }

        .footer-link {
            color: var(--text-secondary);
            text-decoration: none;
            display: block;
            margin-bottom: 0.5rem;
        }

        .footer-link:hover {
            color: var(--highlight);
        }

        .site-title {
            font-size: 3.5rem;
            font-weight: 800;
            color: var(--text-color);
            margin-bottom: 0;
            letter-spacing: 4px;
            position: relative;
            display: inline-block;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .site-subtitle {
            font-size: 1.3rem;
            color: var(--text-secondary);
            margin-top: 0.8rem;
            font-weight: 500;
            letter-spacing: 1px;
            opacity: 0.9;
        }

        .navbar .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1.5rem 0;
        }

        .navbar-nav {
            margin-top: 1rem;
        }

        .accordion-item {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            margin-bottom: 0.5rem;
        }

        .accordion-button {
            background-color: var(--secondary-bg);
            color: var(--text-color);
            padding: 1rem 1.5rem;
        }

        .accordion-button:not(.collapsed) {
            background-color: var(--accent-color);
            color: var(--text-color);
        }

        .accordion-button::after {
            filter: invert(1);
        }

        .accordion-body {
            background-color: var(--card-bg);
            color: var(--text-color);
            padding: 1.5rem;
        }

        @media (max-width: 768px) {
            .site-title {
                font-size: 2rem;
                text-align: center;
            }
            
            .site-subtitle {
                font-size: 1rem;
                text-align: center;
            }
        }
    </style>
    </head>
    <body>
        <nav class="navbar navbar-expand-lg">
            <div class="container">
                <div class="text-center">
                    <h1 class="site-title">MBTI</h1>
                    <div class="site-subtitle">Might Be Totally Inaccurate</div>
                </div>
                <div class="navbar-nav ms-auto">
                    <ul class="nav nav-tabs">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" onclick="showTab('test')">測驗</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showTab('personalities')">人格圖鑑</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showTab('testimonials')">用戶評價</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showTab('faq')">FAQ</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="container my-5">
            <!-- 測驗頁面 -->
            <div id="test-page">
                <!-- 開始頁 -->
                <div id="start-page" class="card">
                    <h1 class="text-center site-title">MBTI</h1>
                    <div class="text-center mb-4 site-subtitle">Might Be Totally Inaccurate</div>
                    <p class="text-center mb-4">來看看你到底是哪種沙雕人格？<br>讓我們開始這趟荒謬的自我探索之旅！</p>
                    <div class="text-center">
                        <button class="btn btn-primary" onclick="startTest()">開始測驗</button>
                    </div>
                </div>

                <!-- 問題頁 -->
                <div id="question-page" style="display: none;">
                    <div class="progress-bar">
                        <div id="progress-fill" class="progress-fill"></div>
                    </div>
                    <div class="question-card">
                        <h3 id="question-text" class="mb-4"></h3>
                        <div class="options-container">
                            <button class="option-btn" onclick="selectOption(0)"></button>
                            <button class="option-btn" onclick="selectOption(1)"></button>
                        </div>
                    </div>
                </div>

                <!-- 結果頁 -->
                <div id="result-page" class="card result-card" style="display: none;">
                    <h2>你的人格分析結果</h2>
                    <div class="mbti-emoji" id="mbti-emoji"></div>
                    <div class="mbti-code" id="mbti-result"></div>
                    <div class="description" id="mbti-description"></div>
                    
                    <div class="personality-chart">
                        <canvas id="personalityChart"></canvas>
                    </div>
                    
                    <div class="mt-4">
                        <button class="share-button" onclick="shareResult()">分享結果</button>
                        <button class="btn btn-primary" onclick="retakeTest()">重新測驗</button>
                    </div>
                </div>
            </div>

            <!-- 人格圖鑑頁面 -->
            <div id="personalities-page" class="card" style="display: none;">
                <h2 class="text-center mb-4">人格圖鑑</h2>
                <div class="personality-list" id="personality-list"></div>
            </div>

            <!-- 用戶評價頁面 -->
            <div id="testimonials-page" class="card" style="display: none;">
                <h2 class="text-center mb-4">真實用戶回饋</h2>
                <div class="testimonials-container">
                    <div class="testimonial-card">
                        <p class="testimonial-text">「我以為這是心理測驗，結果被診斷成行走的問號 ❓ 我現在整個人都在疑問句裡面。」</p>
                        <p class="testimonial-author">- 永遠搞不懂的小明</p>
                    </div>
                    <div class="testimonial-card">
                        <p class="testimonial-text">「被評為『假裝有在計劃型』，氣到我立刻列了三個代辦事項但還是沒做。」</p>
                        <p class="testimonial-author">- 永遠拖延的阿龍</p>
                    </div>
                    <div class="testimonial-card">
                        <p class="testimonial-text">「說我打哈欠打到人類進化都能跳下一階段，謝謝你喔真的超鼓勵人。」</p>
                        <p class="testimonial-author">- 睡不飽的小美</p>
                    </div>
                    <div class="testimonial-card">
                        <p class="testimonial-text">「我室友測完直接搬出去，說她不想跟一個『我就爛型』住在一起。求新室友！」</p>
                        <p class="testimonial-author">- 突然失去室友的阿華</p>
                    </div>
                    <div class="testimonial-card">
                        <p class="testimonial-text">「這測驗唯一準的地方是說我會笑爛，因為我真的笑到肚子痛。笑著笑著就哭了。」</p>
                        <p class="testimonial-author">- 情緒起伏大的小玉</p>
                    </div>
                    <div class="testimonial-card">
                        <p class="testimonial-text">「這不是 MBTI，這是 MBDB（沒必要但挺白癡）測驗吧？但我怎麼測了十次...」</p>
                        <p class="testimonial-author">- 上癮的阿傑</p>
                    </div>
                </div>
            </div>

            <!-- FAQ 頁面 -->
            <div id="faq-page" class="card" style="display: none;">
                <h2 class="text-center mb-4">🤷 常見問題 FAQ（其實沒人問）</h2>
                <div class="accordion" id="faqAccordion">
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="q1">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#a1">
                                Q1：這個人格測驗準嗎？
                            </button>
                        </h2>
                        <div id="a1" class="accordion-collapse collapse show" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                一點都不準，但至少它不會偷你資料（應該啦）。
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header" id="q2">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#a2">
                                Q2：為什麼我會被判定為 ZZZL？
                            </button>
                        </h2>
                        <div id="a2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                因為你答題時有 40% 的時間在發呆，我們的系統看得一清二楚（其實只是亂抓）。
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header" id="q3">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#a3">
                                Q3：可以重測嗎？
                            </button>
                        </h2>
                        <div id="a3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                當然可以，我們完全不負責結果一致性。想玩幾次就玩幾次，佛系經營。
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header" id="q4">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#a4">
                                Q4：這測驗背後有什麼科學依據嗎？
                            </button>
                        </h2>
                        <div id="a4" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                有，科學地亂寫的依據，請放心，我們自己都信了。
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item">
                        <h2 class="accordion-header" id="q5">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#a5">
                                Q5：可以分享給朋友嗎？
                            </button>
                        </h2>
                        <div id="a5" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                當然可以，讓朋友也一起被嗆一頓，友情更加深厚（或破裂）。
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 相容性分析 -->
        <div class="compatibility-section" style="display: none;">
            <h3>相容性分析</h3>
            <div class="compatibility-chart">
                <div class="compatibility-item compatibility-good">
                    <h4>最佳拍檔</h4>
                    <p>LMAO (笑爛型) + WTFJ (假裝有在計劃型)<br>
                    一個負責搞笑，一個負責記錄但從不執行</p>
                </div>
                <div class="compatibility-item compatibility-bad">
                    <h4>災難組合</h4>
                    <p>SIGH (無聲嘆息型) + BRUH (攤手型)<br>
                    兩個都只會嘆氣，誰都不會主動解決問題</p>
                </div>
            </div>
        </div>

        <!-- 分享結果的模態框 -->
        <div class="modal fade" id="shareModal" tabindex="-1" aria-labelledby="shareModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content" style="background-color: var(--card-bg); color: var(--text-color);">
                    <div class="modal-header border-bottom-0">
                        <h5 class="modal-title" id="shareModalLabel">測驗結果分享</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body text-center">
                        <div id="shareModalEmoji" style="font-size: 3em; margin-bottom: 1rem;"></div>
                        <h3 id="shareModalType" style="color: var(--accent-color);"></h3>
                        <p id="shareModalDesc" class="mt-3"></p>
                        <div class="mt-4">
                            <div class="input-group mb-3">
                                <input type="text" id="shareUrlInput" class="form-control bg-dark text-light" readonly>
                                <button class="btn btn-primary" type="button" id="copyShareUrlBtn">
                                    複製連結
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer border-top-0">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <div class="container">
                <div class="row">
                    <div class="col-md-4">
                        <h5 class="footer-heading">關於我們</h5>
                        <p>泛人格量子糾纏研究中心成立於2025年，專注於研究各種不務正業的人格特質。</p>
                    </div>
                    <div class="col-md-4">
                        <h5 class="footer-heading">聯絡資訊</h5>
                        <a href="#" class="footer-link">電子郵件：contact@quantum-mbti.com</a>
                        <a href="#" class="footer-link">地址：薛丁格的貓隔壁</a>
                        <a href="#" class="footer-link">電話：(02) 2599-9999</a>
                    </div>
                    <div class="col-md-4">
                        <h5 class="footer-heading">法律資訊</h5>
                        <a href="#" class="footer-link">隱私權政策</a>
                        <a href="#" class="footer-link">使用條款</a>
                        <a href="#" class="footer-link">免責聲明</a>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-12 text-center">
                        <p class="text-secondary">© 2025 泛人格量子糾纏研究中心. All rights reserved.</p>
                    </div>
                </div>
            </div>
        </footer>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            const mbtiTypes = {
                'ZZZL': {
                    emoji: '💤',
                    name: '睡覺型人格',
                    description: '你的人格核心是一個鬧鐘從不響的靈魂。你相信真正的努力是翻身到最舒服的角度。人際交往對你來說像天氣預報：不準也不想看。別人活得很累，你活得很睏。你最常說的話是「再五分鐘」與「蛤，現在幾點？」',
                    dailyTip: '今天要多喝水，補充精神電池！',
                    loveTip: '睡前記得回覆另一半的訊息，不然對方會以為你又睡著了。',
                    workTip: '把鬧鐘調快10分鐘，至少可以假裝準時。',
                    socialTip: '聚會可以去，但記得帶個舒服的頸枕。'
                },
                'IDKT': {
                    emoji: '🧠',
                    name: '我也不知道型',
                    description: '你總是處於準備進入思考狀態的階段。你對未來充滿模糊想像，對現在則感到無感。別人問你想做什麼時，你會認真點頭然後什麼也沒說。你是一塊會自動待機的電子寵物：外表正常，內部空白。',
                    dailyTip: '今天試著做一個決定，哪怕是決定要不要決定。',
                    loveTip: '約會地點請讓對方決定，你只要負責說好。',
                    workTip: '寫個便條貼提醒自己：「猶豫不決也是一種決定」',
                    socialTip: '當別人問意見時，「我考慮一下」是個好藉口。'
                },
                'YAWN': {
                    emoji: '😪',
                    name: '打哈欠型人格',
                    description: '你的存在是一種低電量生活哲學。你不喜歡爭論，因為那會浪費用來發呆的時間。你對世界的回應是：「可以先不要嗎？」你最嚮往的生活是—什麼都不嚮往，因為太麻煩。',
                    dailyTip: '提醒自己：哈欠也是一種運動。',
                    loveTip: '約會時打哈欠要記得遮住嘴巴。',
                    workTip: '把重要工作安排在清醒的時候做。',
                    socialTip: '聚會時喝杯提神飲料，至少撐到飯局結束。'
                },
                'WTHF': {
                    emoji: '😐',
                    name: '蛤什麼型人格',
                    description: '你的反射神經與社會脈絡之間有時差。問題對你來說不重要，重要的是等下要吃什麼。你擅長在關鍵時刻露出「蛤？」的表情，然後突然結束對話。你不是沒在聽，只是在等靈魂上線。',
                    dailyTip: '今天請至少理解三句別人說的話。',
                    loveTip: '戀愛時要學會適時點頭，不要每句話都回「蛤？」',
                    workTip: '開會時記得帶筆記本，至少看起來有在聽。',
                    socialTip: '聊天時可以偷看別人的反應來跟著笑。'
                },
                'OKNO': {
                    emoji: '👀',
                    name: '全盤否定型人格',
                    description: '你的人生態度是：先說好，但我不一定會做。你總是表示同意，然後默默反方向前進。你是團隊中最安靜但最神秘的存在，因為大家根本搞不懂你到底有沒有來過。你活得像開放原始碼：沒人知道你改過什麼。',
                    dailyTip: '說好就是好，別再說「好，可是...」',
                    loveTip: '答應的約會要記得去，不要又放鴿子。',
                    workTip: '工作進度不要老是說「快好了」然後沒下文。',
                    socialTip: '不想去就直說，別答應了又不出現。'
                },
                'LMAO': {
                    emoji: '😂',
                    name: '笑爛型人格',
                    description: '你的口頭禪是「我沒事」，但眼神裡已經放棄思考。你用笑掩蓋尷尬，用笑對抗無能，用笑笑面對人生—然後默默打開冷氣吹臉。你的人際關係像動態牆：好像很多，但點進去都沒有互動。',
                    dailyTip: '今天也要記得保養臉部肌肉，別笑太誇張。',
                    loveTip: '對方傷心時，請收起你的笑容聽他說話。',
                    workTip: '開會簡報時，觀眾笑了你才能笑。',
                    socialTip: '朋友遇到困難時，給個擁抱比給個笑容好。'
                },
                'WTFJ': {
                    emoji: '📝',
                    name: '假裝有在計劃型人格',
                    description: '你活得像一本未完的筆記本。喜歡列出超完整行程，但執行率跟國會出席率一樣低。你對人生的掌控方式是「先做表格再焦慮」。你不是沒努力，只是太會把重點放在字體大小和配色。',
                    dailyTip: '別只把事情寫在To-Do List上，偶爾也要動手做。',
                    loveTip: '戀愛不是專案管理，別老是用甘特圖規劃約會。',
                    workTip: '做計畫時請預留時間給意外狀況和拖延症。',
                    socialTip: '朋友約你時不要說「讓我查一下行事曆」就消失了。'
                },
                'LOLX': {
                    emoji: '🤪',
                    name: '強行幽默型人格',
                    description: '你總是在錯的時間講對的垃圾話。別人哭你笑，別人笑你更笑。你不是沒有情緒，只是永遠不給別人正常反應。你以為自己像網路迷因，結果大家以為你需要幫助。',
                    dailyTip: '今天就算開心也要顧及別人情緒喔！',
                    loveTip: '約會時不是每句話都要加梗，試著正經一點。',
                    workTip: '開會時的玩笑要適量，主管快生氣時要懂得收。',
                    socialTip: '朋友難過時，不要急著說「至少你還有...」'
                },
                'IHML': {
                    emoji: '💔',
                    name: '我就爛型人格',
                    description: '你是挫折的收藏家，悲劇的觀察員，放棄的行動派。你能在三秒內解釋失敗原因，但花三天還沒決定要不要努力。你不是沒有潛力，只是不相信潛力這種東西值得開發。',
                    dailyTip: '當別人要你努力的時候，不如先擁抱自己的爛。',
                    loveTip: '別老說自己配不上對方，先讓對方決定要不要離開。',
                    workTip: '爛歸爛，至少要在薪水範圍內的爛。',
                    socialTip: '朋友約你出門時，別說「我很爛你確定要約我？」'
                },
                'SIGH': {
                    emoji: '😩',
                    name: '無聲叹息型人格',
                    description: '你說過最多的話是「唉」，你活得像一部安靜又長的紀錄片。你不是懶，只是害怕做了之後會更懶。你很有同理心，但那只是因為你也很常崩潰。你的情緒像蓄水池：平時不流動，一洩就爆。',
                    dailyTip: '嘆氣也是呼吸，但今天試著吸口新鮮空氣。',
                    loveTip: '戀愛時請記得，對方不是你的心理諮商師。',
                    workTip: '工作遇到問題時，先深呼吸再嘆氣。',
                    socialTip: '朋友約你時別只會說「唉，算了吧」。'
                },
                'BRUH': {
                    emoji: '😑',
                    name: '攤手型人格',
                    description: '你對生活的熱情只維持到鬧鐘響的那一刻。你擅長「點頭假裝懂」，實際上只在乎午餐吃什麼。你不是不努力，只是會評估努力值和可能失敗率然後選擇放棄。你最大的強項是：把所有責任都歸給天氣。',
                    dailyTip: '別老攤手，有時候伸手幫忙也是一種尊重。',
                    loveTip: '感情需要經營，不是每次都回「隨便你」。',
                    workTip: '遇到困難不要馬上投降，至少試著掙扎一下。',
                    socialTip: '朋友問意見時，給出一個明確答案吧。'
                },
                'FMLQ': {
                    emoji: '🎭',
                    name: '自認主角型人格',
                    description: '你覺得全世界都是配角，自己的煩惱才是本季主線。你會懷疑別人是不是在看你，但從不考慮自己是不是太戲多。你喜歡對著鏡子練習回應尷尬場面，即使現實裡沒人鳥你。',
                    dailyTip: '今天也要記得：不是每個人都在你的劇本裡。',
                    loveTip: '戀愛不是獨角戲，請給對方一點台詞。',
                    workTip: '開會時不要搶別人的戲，讓同事也有發言機會。',
                    socialTip: '朋友聚會時，請記得配角也需要鏡頭。'
                },
                'TMIK': {
                    emoji: '📢',
                    name: '過度解釋型人格',
                    description: '你的人設是資訊型NPC，別人問你幾點，你講時區與人類定義時間的歷史。你怕被誤會，也怕不被問，所以會自動開啟「補充模式」。你的腦內有永不打烊的語音導航，還不能關靜音。',
                    dailyTip: '別一次講太多，會讓人誤以為你在開研討會。',
                    loveTip: '約會時給對方說話的機會，不要變成個人演講。',
                    workTip: '報告時請記得：簡報重點不是證明你很懂。',
                    socialTip: '朋友分享時，不用每句話都補充專業知識。'
                },
                'AFKZ': {
                    emoji: '🏃‍♂️',
                    name: '神隱型人格',
                    description: '你是社交場合的殘影，點名系統的天敵。你出現在群組只為打個「好」，然後再消失半年。你不是不喜歡大家，只是不喜歡大家知道你喜不喜歡大家。你的人設是：出現沒人驚喜，消失大家安心。',
                    dailyTip: '偶爾也要回一下訊息，讓大家知道你還在人間。',
                    loveTip: '戀愛時請記得：已讀不回是一種傷害。',
                    workTip: '會議不是可選活動，至少要請假。',
                    socialTip: '朋友約你時，「已讀」之後請回應一下。'
                },
                'OOPS': {
                    emoji: '💥',
                    name: '懵懂行動派人格',
                    description: '你的人生哲學是：「先動再說，出事再修。」你不是不怕錯，只是不知道哪裡會錯。你衝得快，摔得快，笑得也快。你經常說：「啊我以為這樣可以欸？」然後全場沉默。',
                    dailyTip: '今天也要記得：三思而後行不是壞事。',
                    loveTip: '感情不是實驗室，請別拿來測試各種可能性。',
                    workTip: '行動前請先和同事確認一下計畫。',
                    socialTip: '朋友的事情，不要急著幫忙「解決」。'
                },
                '???!': {
                    emoji: '❓',
                    name: '問號型人格',
                    description: '你不是活在世界裡，而是活在每個「為什麼」裡。你像一個走失的Wi-Fi訊號，總是在嘗試理解但始終連不上邏輯。你不是沒想法，只是你的想法沒人能解碼。你的人生是一串未解析的變數。',
                    dailyTip: '今天試著不要問太多為什麼。',
                    loveTip: '戀愛不是偵探推理，不用事事都要找原因。',
                    workTip: '開會時不要每件事都問「為什麼」。',
                    socialTip: '朋友講故事時，請先聽完再問問題。'
                }
            };

            // 原始問題資料
            let allQuestions = [];
            
            // 當前測驗使用的問題
            let currentQuestions = [];
            let currentQuestion = 0;
            let userAnswers = [];
            
            // 載入 CSV 檔案
            async function loadQuestions() {
                // 預設的10個問題
                allQuestions = [
                    {
                        id: "1",
                        question: "有人突然對你說『你變了』，你會怎樣？",
                        options: [
                            { text: "認真反省一秒後轉頭繼續滑手機。", tag: "沒救" },
                            { text: "問他哪裡變？是不是變帥了。", tag: "裝懂" }
                        ]
                    },
                    {
                        id: "2",
                        question: "面試官問你缺點是什麼，你會說：",
                        options: [
                            { text: "太完美讓別人壓力大。", tag: "自戀" },
                            { text: "無法拒絕躺著的誘惑。", tag: "懶鬼" }
                        ]
                    },
                    {
                        id: "3",
                        question: "你走進房間發現地板在發光，你會？",
                        options: [
                            { text: "認真地思考自己是不是異世界主角。", tag: "戲精" },
                            { text: "立刻拍限動打卡。", tag: "自戀" }
                        ]
                    },
                    {
                        id: "4",
                        question: "你的房間有100隻鴨子，第一件事是？",
                        options: [
                            { text: "開直播拍片賺流量。", tag: "戲精" },
                            { text: "把牠們命名再放進履歷寫上鴨群管理經驗。", tag: "裝懂" }
                        ]
                    },
                    {
                        id: "5",
                        question: "你通常怎麼決定早餐？",
                        options: [
                            { text: "看緣分抽塔羅卡。", tag: "混亂" },
                            { text: "吃昨天沒吃完的晚餐。", tag: "懶鬼" }
                        ]
                    },
                    {
                        id: "6",
                        question: "你最常做的夢是什麼？",
                        options: [
                            { text: "夢見自己在睡覺。", tag: "懶鬼" },
                            { text: "夢見自己是宇宙超級英雄。", tag: "戲精" }
                        ]
                    },
                    {
                        id: "7",
                        question: "如果給你一個神奇按鈕，你會？",
                        options: [
                            { text: "研究按鈕的原理然後寫篇論文。", tag: "裝懂" },
                            { text: "直接按下去看會發生什麼。", tag: "混亂" }
                        ]
                    },
                    {
                        id: "8",
                        question: "朋友說你很厲害，你會？",
                        options: [
                            { text: "謙虛地說：『我知道。』", tag: "自戀" },
                            { text: "開始懷疑朋友是不是想借錢。", tag: "沒救" }
                        ]
                    },
                    {
                        id: "9",
                        question: "你的口頭禪是？",
                        options: [
                            { text: "『這個我懂！』（其實不懂）", tag: "裝懂" },
                            { text: "『算了算了』（根本沒算）", tag: "沒救" }
                        ]
                    },
                    {
                        id: "10",
                        question: "如果可以擁有一個超能力？",
                        options: [
                            { text: "時間暫停（多睡一會）", tag: "懶鬼" },
                            { text: "讀心術（但只能讀到對方在想午餐）", tag: "混亂" }
                        ]
                    }
                ];
                
                currentQuestions = allQuestions;
            }

            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            async function startTest() {
                if (allQuestions.length === 0) {
                    await loadQuestions();
                }
                
                // 從所有問題中隨機選擇10題
                currentQuestions = allQuestions.slice(0, 10);
                shuffleArray(currentQuestions);
                
                currentQuestion = 0;
                userAnswers = [];
                document.getElementById('start-page').style.display = 'none';
                document.getElementById('question-page').style.display = 'block';
                showQuestion();
            }

            function showQuestion() {
                if (!currentQuestions || currentQuestions.length === 0) {
                    console.error('沒有可用的題目');
                    alert('載入題目時發生錯誤，請重新整理頁面。');
                    retakeTest();
                    return;
                }

                try {
                    const questionData = currentQuestions[currentQuestion];
                    if (!questionData) {
                        throw new Error('無效的題目資料');
                    }

                    const progressPercentage = (currentQuestion / currentQuestions.length) * 100;
                    document.getElementById('progress-fill').style.width = `${progressPercentage}%`;
                    document.getElementById('question-text').textContent = questionData.question;

                    const optionButtons = document.getElementsByClassName('option-btn');
                    optionButtons[0].textContent = questionData.options[0].text;
                    optionButtons[1].textContent = questionData.options[1].text;

                    document.getElementById('question-page').style.display = 'block';
                } catch (error) {
                    console.error('顯示題目時發生錯誤:', error);
                    alert('顯示題目時發生錯誤，請重新開始測驗。');
                    retakeTest();
                }
            }

            function selectOption(optionIndex) {
                try {
                    if (!currentQuestions[currentQuestion]) {
                        throw new Error('無效的題目');
                    }
                    
                    userAnswers.push({
                        answer: optionIndex,
                        tag: currentQuestions[currentQuestion].options[optionIndex].tag
                    });
                    
                    if (currentQuestion < currentQuestions.length - 1) {
                        currentQuestion++;
                        showQuestion();
                    } else {
                        showResult();
                    }
                } catch (error) {
                    console.error('選擇選項時發生錯誤:', error);
                    alert('選擇選項時發生錯誤，請重新開始測驗。');
                    retakeTest();
                }
            }

            function analyzeTags(answers) {
                const tagCounts = {};
                answers.forEach(answer => {
                    const tag = currentQuestions[userAnswers.indexOf(answer)].options[answer.answer].tag;
                    tagCounts[tag] = (tagCounts[tag] || 0) + 1;
                });
                
                // 找出最多和最少的標籤
                let maxCount = 0;
                let minCount = Infinity;
                let dominantTag = '';
                let oppositeTag = '';
                
                for (const [tag, count] of Object.entries(tagCounts)) {
                    if (count > maxCount) {
                        maxCount = count;
                        dominantTag = tag;
                    }
                    if (count < minCount) {
                        minCount = count;
                        oppositeTag = tag;
                    }
                }
                return { dominantTag, oppositeTag };
            }

            function getRandomItems(array, count) {
                const shuffled = [...array].sort(() => 0.5 - Math.random());
                return shuffled.slice(0, count);
            }

            function generateRandomColor() {
                try {
                    const hue = Math.floor(Math.random() * 360);
                    return `hsl(${hue}, 70%, 90%)`;
                } catch (error) {
                    console.error('生成顏色時發生錯誤:', error);
                    return '#f0f0f0'; // 預設顏色
                }
            }

            const personalityTags = {
                '戲精': ['FMLQ', 'LMAO', 'LOLX'],
                '自戀': ['TMIK', 'FMLQ', 'LOLX'],
                '裝懂': ['TMIK', 'WTFJ', 'OOPS'],
                '懶鬼': ['ZZZL', 'YAWN', 'AFKZ'],
                '混亂': ['IDKT', 'OOPS', '???!'],
                '沒救': ['IHML', 'BRUH', 'SIGH']
            };

            function showTab(tabName) {
                const pages = {
                    'test': 'test-page',
                    'personalities': 'personalities-page',
                    'testimonials': 'testimonials-page',
                    'faq': 'faq-page'
                };

                // Hide all pages
                Object.values(pages).forEach(pageId => {
                    document.getElementById(pageId).style.display = 'none';
                });

                // Show selected page
                document.getElementById(pages[tabName]).style.display = 'block';

                // Update active tab
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                event.target.classList.add('active');

                if (tabName === 'personalities') {
                    displayAllPersonalities();
                }
            }

            function displayAllPersonalities() {
                try {
                    const container = document.getElementById('personality-list');
                    if (!container) {
                        throw new Error('找不到性格列表容器');
                    }
                    
                    container.innerHTML = '';
                    
                    Object.entries(mbtiTypes).forEach(([code, data]) => {
                        if (!data || !data.emoji || !data.name || !data.description) {
                            throw new Error(`性格類型 ${code} 資料不完整`);
                        }

                        const div = document.createElement('div');
                        div.className = 'personality-item';
                        div.innerHTML = `
                            <div class="d-flex align-items-center mb-3">
                                <span class="personality-emoji" style="font-size: 2em; margin-right: 0.5rem;">${data.emoji}</span>
                                <h3 class="personality-code mb-0">${code}</h3>
                            </div>
                            <h4 class="personality-name mb-2">${data.name}</h4>
                            <p class="personality-description mb-0">${data.description}</p>
                        `;
                        container.appendChild(div);
                    });
                } catch (error) {
                    console.error('顯示所有性格時發生錯誤:', error);
                    const container = document.getElementById('personality-list');
                    if (container) {
                        container.innerHTML = '<p class="text-danger">載入性格資料時發生錯誤，請重新整理頁面</p>';
                    }
                }
            }

            function showResult() {
                try {
                    // 隱藏開始頁面和問題頁面
                    document.getElementById('start-page').style.display = 'none';
                    document.getElementById('question-page').style.display = 'none';
                    
                    // 顯示結果頁面
                    document.getElementById('result-page').style.display = 'block';
                    
                    const { dominantTag, oppositeTag } = analyzeTags(userAnswers);
                    const possibleTypes = personalityTags[dominantTag] || [];
                    const oppositeTypes = personalityTags[oppositeTag] || [];
                    
                    const selectedType = possibleTypes[Math.floor(Math.random() * possibleTypes.length)] || 'IDKT';
                    const result = mbtiTypes[selectedType];
                    
                    // 更新結果顯示
                    document.getElementById('mbti-emoji').textContent = result.emoji;
                    document.getElementById('mbti-result').textContent = selectedType;
                    document.getElementById('mbti-description').textContent = result.description;
                    
                    // 添加人格專屬建議
                    const adviceSection = document.createElement('div');
                    adviceSection.className = 'mt-4 p-3 bg-dark rounded text-light';
                    adviceSection.innerHTML = `
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <h5 class="text-warning">🌞 今日建議</h5>
                                <p class="small">${result.dailyTip}</p>
                            </div>
                            <div class="col-md-6 mb-3">
                                <h5 class="text-danger">❤️ 情感建議</h5>
                                <p class="small">${result.loveTip}</p>
                            </div>
                            <div class="col-md-6 mb-3">
                                <h5 class="text-info">💼 工作/學業建議</h5>
                                <p class="small">${result.workTip}</p>
                            </div>
                            <div class="col-md-6 mb-3">
                                <h5 class="text-success">🤝 社交建議</h5>
                                <p class="small">${result.socialTip}</p>
                            </div>
                        </div>
                    `;
                    
                    // 在圖表前插入建議內容
                    const chartContainer = document.querySelector('.personality-chart');
                    chartContainer.before(adviceSection);
                    
                    // 創建圖表
                    createPersonalityChart();
                } catch (error) {
                    console.error('顯示結果時發生錯誤:', error);
                    alert('顯示結果時發生錯誤，請重新開始測驗。');
                    retakeTest();
                }
            }

            function createPersonalityChart() {
                try {
                    // 分析答案得到的標籤統計
                    const tagStats = {
                        '戲精': 0,
                        '自戀': 0,
                        '裝懂': 0,
                        '懶鬼': 0,
                        '混亂': 0,
                        '沒救': 0
                    };

                    userAnswers.forEach(answer => {
                        const tag = currentQuestions[userAnswers.indexOf(answer)].options[answer.answer].tag;
                        tagStats[tag] = (tagStats[tag] || 0) + 1;
                    });

                    // 準備圖表數據
                    const ctx = document.getElementById('personalityChart').getContext('2d');
                    const chartData = {
                        labels: Object.keys(tagStats),
                        datasets: [{
                            data: Object.values(tagStats),
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.5)',
                                'rgba(54, 162, 235, 0.5)',
                                'rgba(255, 206, 86, 0.5)',
                                'rgba(75, 192, 192, 0.5)',
                                'rgba(153, 102, 255, 0.5)',
                                'rgba(255, 159, 64, 0.5)'
                            ],
                            borderColor: [
                                'rgba(255, 99, 132, 1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 206, 86, 1)',
                                'rgba(75, 192, 192, 1)',
                                'rgba(153, 102, 255, 1)',
                                'rgba(255, 159, 64, 1)'
                            ],
                            borderWidth: 1
                        }]
                    };

                    // 建立圖表
                    if (window.myChart) {
                        window.myChart.destroy();
                    }
                    
                    window.myChart = new Chart(ctx, {
                        type: 'radar',
                        data: chartData,
                        options: {
                            scales: {
                                r: {
                                    beginAtZero: true,
                                    max: 5,
                                    ticks: {
                                        stepSize: 1
                                    },
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    },
                                    angleLines: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    },
                                    pointLabels: {
                                        color: '#ffffff'
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false
                                }
                            }
                        }
                    });

                    // 更新相容性圖表
                    const dominantTag = analyzeTags(userAnswers);
                    updateCompatibilityChart(dominantTag);
                    
                    // 顯示相容性部分
                    document.querySelector('.compatibility-section').style.display = 'block';

                } catch (error) {
                    console.error('建立圖表時發生錯誤:', error);
                    const chartContainer = document.querySelector('.personality-chart');
                    if (chartContainer) {
                        chartContainer.innerHTML = '<p class="text-danger">圖表載入失敗</p>';
                    }
                }
            }

            function updateCompatibilityChart(personalityType) {
                try {
                    if (!personalityType) {
                        throw new Error('未提供性格類型');
                    }

                    const compatibilityData = {
                        'ZZZL': {
                            good: ['YAWN', 'OKNO'],
                            bad: ['FMLQ', 'TMIK']
                        },
                        'IDKT': {
                            good: ['OOPS', '???!'],
                            bad: ['LMAO', 'WTFJ']
                        },
                        'YAWN': {
                            good: ['ZZZL', 'OKNO'],
                            bad: ['FMLQ', 'TMIK']
                        },
                        'WTHF': {
                            good: ['OOPS', '???!'],
                            bad: ['LMAO', 'WTFJ']
                        },
                        'OKNO': {
                            good: ['ZZZL', 'YAWN'],
                            bad: ['FMLQ', 'TMIK']
                        },
                        'LMAO': {
                            good: ['WTFJ', 'LOLX'],
                            bad: ['IHML', 'SIGH']
                        },
                        'WTFJ': {
                            good: ['LMAO', 'LOLX'],
                            bad: ['IHML', 'SIGH']
                        },
                        'LOLX': {
                            good: ['LMAO', 'WTFJ'],
                            bad: ['IHML', 'SIGH']
                        },
                        'IHML': {
                            good: ['SIGH', 'BRUH'],
                            bad: ['FMLQ', 'TMIK']
                        },
                        'SIGH': {
                            good: ['IHML', 'BRUH'],
                            bad: ['FMLQ', 'TMIK']
                        },
                        'BRUH': {
                            good: ['IHML', 'SIGH'],
                            bad: ['FMLQ', 'TMIK']
                        },
                        'FMLQ': {
                            good: ['TMIK', 'WTFJ'],
                            bad: ['ZZZL', 'YAWN']
                        },
                        'TMIK': {
                            good: ['FMLQ', 'WTFJ'],
                            bad: ['ZZZL', 'YAWN']
                        },
                        'AFKZ': {
                            good: ['ZZZL', 'YAWN'],
                            bad: ['FMLQ', 'TMIK']
                        },
                        'OOPS': {
                            good: ['IDKT', 'WTHF'],
                            bad: ['LMAO', 'WTFJ']
                        },
                        '???!': {
                            good: ['IDKT', 'WTHF'],
                            bad: ['LMAO', 'WTFJ']
                        }
                    };

                    // 更新相容性圖表內容
                    const data = compatibilityData[personalityType] || {
                        good: ['LMAO', 'WTFJ'],
                        bad: ['SIGH', 'BRUH']
                    };

                    const goodContainer = document.querySelector('.compatibility-good');
                    const badContainer = document.querySelector('.compatibility-bad');

                    if (!goodContainer || !badContainer) {
                        throw new Error('找不到相容性圖表容器');
                    }

                    goodContainer.innerHTML = '<h4>最佳拍檔</h4>';
                    badContainer.innerHTML = '<h4>災難組合</h4>';

                    data.good.forEach(type => {
                        const personality = mbtiTypes[type];
                        if (personality) {
                            goodContainer.innerHTML += `
                                <div class="compatibility-item">
                                    <p class="mb-1"><strong>${type}</strong> (${personality.name})</p>
                                    <small class="text-muted">${personality.emoji}</small>
                            </div>`;
                        }
                    });

                    data.bad.forEach(type => {
                        const personality = mbtiTypes[type];
                        if (personality) {
                            badContainer.innerHTML += `
                                <div class="compatibility-item">
                                    <p class="mb-1"><strong>${type}</strong> (${personality.name})</p>
                                    <small class="text-muted">${personality.emoji}</small>
                            </div>`;
                        }
                    });
                } catch (error) {
                    console.error('更新相容性圖表時發生錯誤:', error);
                    const containers = document.querySelectorAll('.compatibility-good, .compatibility-bad');
                    containers.forEach(container => {
                        if (container) {
                            container.innerHTML = '<p class="text-danger">載入相容性資料時發生錯誤</p>';
                        }
                    });
                }
            }

            function shareResult() {
                try {
                    const mbtiResult = document.getElementById('mbti-result').textContent;
                    const mbtiEmoji = document.getElementById('mbti-emoji').textContent;
                    const description = document.getElementById('mbti-description').textContent;
                    
                    // 生成分享連結
                    const params = new URLSearchParams();
                    params.set('type', mbtiResult);
                    params.set('desc', description);
                    const shareUrl = `${window.location.origin}${window.location.pathname}?${params.toString()}`;
                    
                    // 更新模態框內容
                    document.getElementById('shareModalEmoji').textContent = mbtiEmoji;
                    document.getElementById('shareModalType').textContent = mbtiResult;
                    document.getElementById('shareModalDesc').textContent = description;
                    document.getElementById('shareUrlInput').value = shareUrl;
                    
                    // 複製按鈕點擊事件
                    document.getElementById('copyShareUrlBtn').onclick = function() {
                        const shareUrlInput = document.getElementById('shareUrlInput');
                        shareUrlInput.select();
                        document.execCommand('copy');
                        this.textContent = '已複製！';
                        setTimeout(() => {
                            this.textContent = '複製連結';
                        }, 2000);
                    };
                    
                    // 顯示模態框
                    const shareModal = new bootstrap.Modal(document.getElementById('shareModal'));
                    shareModal.show();
                } catch (error) {
                    console.error('顯示分享視窗時發生錯誤:', error);
                    alert('顯示分享視窗時發生錯誤，請再試一次。');
                }
            }

            // 處理分享頁面的顯示
            function handleSharedResult() {
                const params = new URLSearchParams(window.location.search);
                const sharedType = params.get('type');
                const sharedDesc = params.get('desc');

                if (sharedType && sharedDesc) {
                    // 隱藏其他頁面
                    document.getElementById('start-page').style.display = 'none';
                    document.getElementById('question-page').style.display = 'none';

                    // 顯示分享結果頁面
                    const resultPage = document.getElementById('result-page');
                    resultPage.style.display = 'block';

                    // 更新結果內容
                    document.getElementById('mbti-result').textContent = sharedType;
                    document.getElementById('mbti-description').textContent = sharedDesc;
                    document.getElementById('mbti-emoji').textContent = mbtiTypes[sharedType]?.emoji || '❓';

                    // 添加邀請測驗按鈕
                    const inviteButton = document.createElement('button');
                    inviteButton.className = 'btn btn-primary mt-3';
                    inviteButton.textContent = '來試試看你的人格類型！';
                    inviteButton.onclick = () => {
                        window.location.href = window.location.pathname;
                    };
                    resultPage.querySelector('.mt-4').appendChild(inviteButton);
                }
            }

            // 在頁面載入時檢查是否為分享頁面
            document.addEventListener('DOMContentLoaded', function() {
                // ...existing code...
                
                // 檢查是否為分享頁面
                handleSharedResult();
            });

            function retakeTest() {
                // 重置測驗狀態
                currentQuestion = 0;
                userAnswers = [];

                // 清除圖表
                const chartContainer = document.querySelector('.personality-chart');
                if (chartContainer) {
                    chartContainer.innerHTML = '<canvas id="personalityChart"></canvas>';
                }

                // 清除人格專屬建議
                const adviceSection = document.querySelector('.bg-dark.rounded.text-light');
                if (adviceSection) {
                    adviceSection.remove();
                }

                // 隱藏結果頁面
                document.getElementById('result-page').style.display = 'none';
                // 隱藏相容性分析
                document.querySelector('.compatibility-section').style.display = 'none';
                // 顯示開始頁面
                document.getElementById('start-page').style.display = 'block';
            }
        </script>
    </body>
</html>
